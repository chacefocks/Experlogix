var SEARCHBOX_DROPDOWNID="sbDropDown",EditBuffer={init:function(a){this.ctl=a;this.buffer=""},clear:function(){this.buffer="";this.ctl.value=""},getSel:function(){return GetInputSelection(this.ctl)},insertChar:function(b){var a=this.getSel();this.insertCharImpl(b,a)},insertCharImpl:function(b,a){if(a.len()>0||a.start>0&&a.start<this.buffer.length)this.buffer=this.buffer.substr(0,a.start)+b+this.buffer.substr(a.start+a.len());else if(a.start>=this.buffer.length)this.buffer+=b;else this.buffer=b+this.buffer},deleteChar:function(){var a=this.getSel();this.deleteCharImpl(a)},deleteCharImpl:function(a){if(a.len()>0)this.buffer=this.buffer.substr(0,a.start)+this.buffer.substr(a.start+a.len());else if(a.start<this.buffer.length)this.buffer=this.buffer.substr(0,a.start)+this.buffer.substr(a.start+1)},backSpace:function(){var a=this.getSel();this.backSpaceImpl(a)},backSpaceImpl:function(a){if(a.len()>0)this.buffer=this.buffer.substr(0,a.start)+this.buffer.substr(a.start+a.len());else if(a.start>0)this.buffer=a.start<this.buffer.length?this.buffer.substr(0,a.start-1)+this.buffer.substr(a.start):this.buffer.substr(0,a.start-1)}},SearchBox={init:function(){var b;if(document.getElementsByClassName)b=document.getElementsByClassName("xSearchBox");else b=document.querySelectorAll(".xSearchBox");for(var c=0;c<b.length;++c){var a=b[c];if(a.searchBox)continue;a.searchBox=this;attachTo(a,"click",this.onClickSearch);a.input=a.children[0];attachTo(a.input,"focus",this.onFocus)}},onClickSearch:function(c){var a=getEventSource(c);if(a.tagName!=="DIV")return;var b=a.searchBox;a.input.focus();setTimeout(function(){b.open()},0)},onFocus:function(g){var b=getEventSource(g),a=b.parentNode.searchBox;a.acquire(b.parentNode);var c=function(b,a,c){return b.hasAttribute(a)?b.getAttribute(a):c},d=function(b,a,d){if(b.hasAttribute(a)){var c=b.getAttribute(a).toLowerCase();return c==="1"||c==="true"}else return d},e=function(b,a,c){if(b.hasAttribute(a)){var d=b.getAttribute(a).toLowerCase();return parseInt(d)}else return c},f=d(b,"sbAutoOpen",false);a.pageSize=e(b,"sbPageSize",10);a.allowExclOpt=d(b,"sbAllowExclOpt",false);a.searchDelay=e(b,"sbDelay",200);a.primaryField=c(b,"sbPrimaryField","Description");a.matchType=c(b,"sbMatchType","Contains");f&&!a.preventAutoOpen&&a.open();a.preventAutoOpen=false},onDocMouseWheel:function(){var a=$elem(SEARCHBOX_DROPDOWNID);if(!a)return;var b=a.searchBox;b.close(true)},onKeyDown:function(b){var f=getEventSource(b),a=f.parentNode.searchBox;if(window.event)b=window.event;var e=window.event?b.keyCode:b.which;switch(e){case 8:if(b.ctrlKey)a.preventDefault(b);else if(b.altKey){setTimeout(function(){EditBuffer.clear();a.performSearch()},0);a.preventDefault(b)}else{EditBuffer.backSpace();a.performSearch()}break;case 9:a.release();break;case 13:if(a.getDropDown()){if(-1==a.currSelIndex&&a.lastResult&&a.lastResult.Rows)a.selectItem(0);else a.selectItem(a.currSelIndex);EditBuffer.clear()}a.preventDefault(b);break;case 27:if(EditBuffer.buffer){EditBuffer.clear();a.performSearch()}else a.close();a.preventDefault(b);break;case 46:if(b.ctrlKey||b.altKey)a.preventDefault(b);else{EditBuffer.deleteChar();a.performSearch()}break;case 115:!a.getDropDown()&&a.open();a.preventDefault(b);break;case 33:if(b.ctrlKey){var d=$elem("navPrev");d&&d.click()}else{a.moveToFirst();a.preventDefault(b)}break;case 34:if(b.ctrlKey){var c=$elem("navNext");c&&c.click()}else{a.moveToLast();a.preventDefault(b)}break;case 36:if(b.ctrlKey){$elem("navPrev")&&a.performNavTo(0);a.preventDefault(b)}break;case 38:if(b.altKey)a.close(true);else a.moveToPrev();a.preventDefault(b);break;case 40:if(!a.getDropDown())a.open();else a.moveToNext();a.preventDefault(b)}},preventDefault:function(a){a.preventDefault?a.preventDefault():(a.returnValue=false)},onKeyPress:function(a){var b=window.event?a.keyCode:a.which;if(!b)return;var d=getEventSource(a),c=d.parentNode.searchBox;switch(b){case 8:return;default:var e=String.fromCharCode(b);EditBuffer.insertChar(e)}c.performSearch()},onPaste:function(c){var a=getEventSource(c),b=a.parentNode.searchBox;setTimeout(function(){EditBuffer.buffer=a.value;b.performSearch()},25)},onCut:function(c){var a=getEventSource(c),b=a.parentNode.searchBox;setTimeout(function(){EditBuffer.buffer=a.value;b.performSearch()},25)},evalEventToClose:function(h){var b=h||window.event,d=b.pageX||b.pageY?{x:b.pageX,y:b.pageY}:{x:b.clientX,y:b.clientY},g=function(a,b,e,c){return d.x>=a&&d.x<=a+e&&(d.y>=b&&d.y<=b+c)},a=$elem(SEARCHBOX_DROPDOWNID);if(!a)return;var e=true;if(g(a.offsetLeft,a.offsetTop,a.offsetWidth,a.offsetHeight))e=false;var c=a.searchBox.currBox;if(!c)return;var f=$(c).offset();if(g(f.left,f.top,c.offsetWidth,c.offsetHeight))e=false;e&&c.searchBox.release()},acquire:function(a){if(this.currBox)if(this.currBox!=a)this.release();else return;attachTo(a.input,"keydown",this.onKeyDown);attachTo(a.input,"keypress",this.onKeyPress);attachTo(a.input,"paste",this.onPaste);attachTo(a.input,"cut",this.onCut);attachTo(window.document,"mousedown",this.evalEventToClose);attachTo(window.document,getBrowser()=="Firefox"?"DOMMouseScroll":"mousewheel",this.onDocMouseWheel);this.currBox=a;this.currCid=a.input.id.substr(2);this.currSelIndex=-1;EditBuffer.init(a.input)},release:function(){var a=this.currBox;detachFrom(a.input,"keydown",this.onKeyDown);detachFrom(a.input,"keypress",this.onKeyPress);detachFrom(a.input,"paste",this.onPaste);detachFrom(a.input,"cut",this.onCut);detachFrom(window.document,"mousedown",this.evalEventToClose);detachFrom(window.document,getBrowser()=="Firefox"?"DOMMouseScroll":"mousewheel",this.onDocMouseWheel);this.close();this.currBox=null;this.currCid=null;this.cancelSearch();this.lastResult=null;EditBuffer.clear()},open:function(){if(!this.currBox||$elem(SEARCHBOX_DROPDOWNID))return;this.close();var a=$c("div");a.className="xSearchBoxDropDown";a.id=SEARCHBOX_DROPDOWNID;a.style.minWidth=this.currBox.offsetWidth+"px";a.searchBox=this;a.innerHTML="<div class='xSearching'>"+SEARCH_SEARCHING+"</div>";document.body.appendChild(a);this.reposition(a);var b=this;setTimeout(function(){b.performSearch()},b.searchDelay);return a},close:function(b){var a=this.getDropDown();if(!a)return;document.body.removeChild(a);if(b){this.currBox.input.blur();this.currBox.input.focus()}},getDropDown:function(){return $elem(SEARCHBOX_DROPDOWNID)},reposition:function(b){var k=function(a){var e=0,f=0,b=0,c=0;while(null!=a){e+=a.offsetLeft||0;f+=a.offsetTop||0;b+=a.scrollLeft||0;c+=a.scrollTop||0;var d=a.parentNode;if(a.offsetParent!=d){b+=d.scrollLeft||0;c+=d.scrollTop||0}a=a.offsetParent}return{horizOffset:e,vertOffset:f,horizScrollOffset:b,vertScrollOffset:c}},a=k(this.currBox),g=a.horizOffset-a.horizScrollOffset,h=a.vertOffset-a.vertScrollOffset+parseInt(this.currBox.offsetHeight)+1,f=b.offsetWidth,e=b.offsetHeight,j=getPageWidth(),i=getPageHeight(),c=g+f>j?j-f:g,d=h+e>i?i-e:h;if(c<0)c=0;if(d<0)d=0;b.style.left=c+"px";b.style.top=d+"px"},cancelSearch:function(){this.searchHandle&&clearTimeout(this.searchHandle)},performSearch:function(){try{var a=this;a.cancelSearch();a.searchHandle=setTimeout(function(){a.performSearchImpl()},a.searchDelay)}catch(b){}},performSearchImpl:function(){if(this.searchHandle){clearTimeout(this.searchHandle);this.searchHandle=null}if(this.currCid==null)return;var d="&cid="+this.currCid,a=this.pageSize?"&vr="+this.pageSize:"",b=this.allowExclOpt?"&aeo=1":"",c="&s="+this.primaryField,f=EditBuffer.buffer.length>0?"&val="+this.escapeToUtf16(this.updateSearchValue(EditBuffer.buffer)):"",e=this.getRootUrl()+"/configurator/handlers/SearchBoxHandler.ashx?action=filter"+d+a+b+c+f;$get(e,SEARCH_ERROR,this.processResponse,this)},performNavTo:function(a){if(this.searchHandle){clearTimeout(this.searchHandle);this.searchHandle=null}if(this.currCid==null)return;var d="&cid="+this.currCid,b=a?"&p="+a:"",c="&s="+this.primaryField,f=EditBuffer.buffer.length>0?"&val="+this.escapeToUtf16(this.updateSearchValue(EditBuffer.buffer)):"",e=this.getRootUrl()+"/configurator/handlers/SearchBoxHandler.ashx?action=nav"+d+b+c+f;$get(e,SEARCH_ERROR,this.processResponse,this)},updateSearchValue:function(h){if("StartsWith"==this.matchType){for(var b="",d=false,e=false,c=false,g=h.trim().split(""),f=0;f<g.length;++f){var a=g[f];if(d)if(" "==a)if(e)b+=a;else{b+=c?a:"* ";d=false;c=false}else if('"'==a)if(e){b+=c?a:'*"';e=false;d=false;c=false}else b+=a;else b+=a;else if(" "==a)b+=a;else if('"'==a){d=true;e=true;b+=a}else{d=true;if("*"==a)c=true;b+=a}}if(d)b+=!c?"*":"";if(e)b+='"';return b}else return h},processResponse:function(f,e){var a=e,c=a.getDropDown();if(!c)c=a.open();var d=f.responseText,b;try{b=JSON.parse(d)}catch(g){b=eval("("+d+")")}if(b.ErrorMessage)a.setContent_Error(c,b);else a.setContent_Rows(c,b);a.reposition(c);a.lastResult=b;a.setSelIndex(-1);a.scrollSelectionInfoView(true);document.activeElement!=a.currBox.input&&a.currBox.input.focus()},setContent_Rows:function(g,c){this.pageIndex=c.PageNumber;var f=c.Rows;if(0==f.length)g.innerHTML="<div class='xNoResults'>"+SEARCH_NO_RESULTS+"</div>";else{g.innerHTML="";var e=function(c,b,d){var a=$c("div",c);a.className="xSubItem";a.innerHTML=b+": "+d},m=$c("div",g);m.className="xItems";for(var d=0;d<f.length;++d){var a=f[d].Data,b=$c("div",m);b.className="xItem";b.id="sbRow"+d.toString();b.setAttribute("rowIndex",d);f[d].IsExcluded&&b.setAttribute("excl","");f[d].IsRequired&&b.setAttribute("req","");attachTo(b,"click",g.searchBox.onItemClick);var h=$c("div",b);h.className="xPrimary";switch(this.primaryField.toLowerCase()){case"optionid":h.innerHTML=a.OptionID;!a.HasOptionIDMatch&&a.HasDescriptionMatch&&e(b,SEARCH_CAP_DESC,a.Description);!a.HasOptionIDMatch&&a.HasHostOptionIDMatch&&e(b,SEARCH_CAP_HOID,a.HostOptionID);break;case"description":h.innerHTML=a.Description||a.OptionID;!a.HasDescriptionMatch&&a.HasOptionIDMatch&&e(b,SEARCH_CAP_OID,a.OptionID);!a.HasDescriptionMatch&&a.HasHostOptionIDMatch&&e(b,SEARCH_CAP_HOID,a.HostOptionID);break;case"hostoptionid":h.innerHTML=a.HostOptionID||a.Description||a.OptionID;!a.HasHostOptionIDMatch&&a.HasOptionIDMatch&&e(b,SEARCH_CAP_OID,a.OptionID);!a.HasHostOptionIDMatch&&a.HasHDescriptionMatch&&e(b,SEARCH_CAP_DESC,a.Description)}}if(c.HasMoreData||c.PageNumber>0){var k=$c("div",g);k.className="xNav";var l=this;if(c.PageNumber>0){var j=$c("div",k);j.id="navPrev";j.className="xPrev";j.setAttribute("targetPage",c.PageNumber-1);attachTo(j,"click",l.onNavClick)}if(c.HasMoreData){var i=$c("div",k);i.id="navNext";i.className="xNext";i.setAttribute("targetPage",c.PageNumber+1);attachTo(i,"click",l.onNavClick)}var o=$c("div",k);o.className="xText";var n=c.PageNumber*l.pageSize+1,p=n+c.Rows.length-1;o.innerText="Items {START} to {END}".formatEx({START:n,END:p})}}},onItemClick:function(b){var a=getEventSource(b);while(a!=null&&a.className!=="xItem")a=a.parentNode;if(null==a)return false;var c=$elem(SEARCHBOX_DROPDOWNID);c.searchBox.selectItem(a.getAttribute("rowIndex"));return false},onNavClick:function(b){var c=getEventSource(b),a=parseInt(c.getAttribute("targetPage")),d=$elem(SEARCHBOX_DROPDOWNID);d.searchBox.performNavTo(a)},setContent_Error:function(b,a){b.innerHTML=a.ErrorMessage},selectItem:function(a){if(a<0)return;var c=this.lastResult&&this.lastResult.Rows?this.lastResult.Rows:null;if(a>=c.length)return;var d=c[a].Id;addOptionPopupSaveCallback([{id:d,cat:this.currCid}]);var b=this.currBox;this.release();b.blur();b.focus()},moveToPrev:function(){if(this.lastResult&&this.lastResult.Rows){var a=this.currSelIndex-1;if(a<=0)a=0;this.setSelIndex(a);this.scrollSelectionInfoView(true)}},moveToNext:function(){if(this.lastResult&&this.lastResult.Rows){var b=this.lastResult.Rows,a=this.currSelIndex+1;if(a>=b.length)a=b.length-1;this.setSelIndex(a);this.scrollSelectionInfoView(false)}},moveToFirst:function(){if(this.lastResult&&this.lastResult.Rows){this.setSelIndex(0);this.scrollSelectionInfoView(true)}},moveToLast:function(){if(this.lastResult&&this.lastResult.Rows){var a=this.lastResult.Rows;this.setSelIndex(a.length-1);this.scrollSelectionInfoView(false)}},setSelIndex:function(b){if(this.currSelIndex!=-1){var c=this.getRow(this.currSelIndex);c&&c.removeAttribute("sel")}var a=this.getRow(b);a&&a.setAttribute("sel","");this.currSelIndex=a?b:-1},scrollSelectionInfoView:function(d){var e=this.currSelIndex==-1?0:this.currSelIndex,c=this.getRow(e);if(c){var f=c.parentNode,b=f.getBoundingClientRect(),a=c.getBoundingClientRect();(a.top<b.top||a.right>b.right||a.bottom>b.bottom||a.left<b.left)&&c.scrollIntoView(d)}},getRow:function(a){return $elem("sbRow"+a)},getRootUrl:function(){var e=/\/experlogix\/(\(S\([^\)]+\)\))\//i,b=location.href,c=b.toLowerCase().lastIndexOf("/experlogix/");if(-1==c)c=b.lastIndexOf("/");var a=c>0?b.substring(0,c):b;if(a[a.length-1]=="/")a=a.substring(0,a.length-1);var d=e.exec(location.href);if(d){var f=d[1];a=a+"/experlogix/"+f}else a=a+"/experlogix";return a},escapeToUtf16:function(d){for(var b="",a=0;a<d.length;++a){var c=d.charCodeAt(a).toString(16).toUpperCase();b+="\\u"+"0000".substr(c.length)+c}return b}};